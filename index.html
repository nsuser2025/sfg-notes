<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>動的Markdownノートビューア（数式対応）</title>

<!-- Marked.js -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<!-- MathJax 設定 -->
<script>
window.MathJax = {
  tex: { 
    packages: {'[+]': ['ams']},   // amsmath を追加
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  },
  options: { skipHtmlTags: ['script','style','textarea','pre'] },
  chtml: { matchFontHeight: false, displayAlign: "left", displayIndent: "2em" },
  loader: { load: ['[tex]/noerrors'] }
};
</script>

<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script"></script>

<style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #note-container { 
        border: 1px solid #ccc; 
        padding: 15px; 
        margin-top: 20px; 
        background-color: #f9f9f9;
        min-height: 200px; 
    }
</style>
</head>
<body>

<h1>Markdown ノート選択</h1>

<label for="chapter-select">ノートを選択してください:</label>
<select id="chapter-select" onchange="loadMarkdown(this.value)">
    <option value="" disabled selected>--- 選択してください ---</option>
    <option value="notes/chapter001.md">第1章：線形感受率</option>
    <option value="notes/chapter2.md">第2章：非線形光学</option>
    <option value="notes/chapter3.md">第3章：フーリエ変換</option>
</select>

<div id="note-container">
    <p>ファイルを選択すると、ここに内容が表示されます。</p>
</div>

<script>
    // Marked.js のオプション設定
    marked.setOptions({
        breaks: true,
        gfm: true,
    });

    /**
     * 指定されたMarkdownファイルを読み込み、HTMLに変換し、MathJaxで数式をレンダリング
     * @param {string} filePath - 読み込むMarkdownファイルへのパス
     */
    function loadMarkdown(filePath) {
        if (!filePath) return;

        const container = document.getElementById('note-container');
        container.innerHTML = '<p>ファイル読み込み中...</p>';

        fetch(filePath)
            .then(res => {
                if (!res.ok) throw new Error(`ファイルの読み込みに失敗しました: ${res.status} ${res.statusText}`);
                return res.text();
            })
            .then(text => {
                container.innerHTML = marked.parse(text);
                MathJax.typesetPromise([container]);
            })
            .catch(err => {
                console.error('Markdown 読み込み失敗:', err);
                container.innerHTML = 
                    `<p style="color: red;"><strong>エラー: ノートの読み込みに失敗しました。</strong></p>
                     <p>エラー詳細: ${err.message}</p>
                     <p>ファイルパス <code>${filePath}</code> が正しいか確認してください。</p>`;
            });
    }
</script>

</body>
</html>
